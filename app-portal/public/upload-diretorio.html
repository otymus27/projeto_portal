<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste de Upload de Diretório e Pastas</title>
    <style>
        body { font-family: sans-serif; }
        form { margin-bottom: 30px; border-bottom: 2px solid #ccc; padding-bottom: 20px; }
        input, button, textarea { padding: 8px; margin: 4px 0; width: 100%; box-sizing: border-box; }
        #status-upload, #status-criar, #status-arquivo { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>1. Upload de Diretório com Arquivos</h1>
    <p>Use este formulário para enviar uma pasta com arquivos. A estrutura será replicada no servidor.</p>
    <form id="uploadForm">
        <label for="token-upload">Token JWT:</label>
        <textarea id="token-upload" placeholder="Cole seu token JWT aqui..." rows="2"></textarea>

        <label for="pastaId-upload">ID da Pasta Destino:</label>
        <input type="number" id="pastaId-upload" name="pastaId" value="1" required>

        <label for="filePicker">Selecione uma pasta para upload:</label>
        <input type="file" id="filePicker" name="files" multiple webkitdirectory directory>

        <button type="submit">Fazer Upload de Diretório</button>
        <h3 id="status-upload"></h3>
    </form>

    <hr>

    <h1>2. Criar uma Pasta Vazia</h1>
    <p>Use este formulário para criar apenas uma nova pasta, sem arquivos.</p>
    <form id="criarPastaForm">
        <label for="token-criar">Token JWT:</label>
        <textarea id="token-criar" placeholder="Cole seu token JWT aqui..." rows="2"></textarea>

        <label for="nomePasta">Nome da Nova Pasta:</label>
        <input type="text" id="nomePasta" name="nomePasta" required>
        
        <label for="pastaPaiId-criar">ID da Pasta Destino:</label>
        <input type="number" id="pastaPaiId-criar" name="pastaPaiId" value="1" required>

        <button type="submit">Criar Pasta</button>
        <h3 id="status-criar"></h3>
    </form>
    
    <hr>
    
    <h1>3. Upload de Arquivo Individual</h1>
    <p>Use este formulário para enviar um ou mais arquivos para uma pasta específica.</p>
    <form id="uploadArquivoForm">
        <label for="token-arquivo">Token JWT:</label>
        <textarea id="token-arquivo" placeholder="Cole seu token JWT aqui..." rows="2"></textarea>

        <label for="pastaId-arquivo">ID da Pasta Destino:</label>
        <input type="number" id="pastaId-arquivo" name="pastaId" value="1" required>

        <label for="file-arquivo">Selecione um ou mais arquivos:</label>
        <input type="file" id="file-arquivo" name="files" multiple>

        <button type="submit">Fazer Upload de Arquivo</button>
        <h3 id="status-arquivo"></h3>
    </form>
    
    <script>
        const uploadForm = document.getElementById('uploadForm');
        const criarPastaForm = document.getElementById('criarPastaForm');
        const uploadArquivoForm = document.getElementById('uploadArquivoForm'); // ✅ Nova referência ao formulário
        const statusUploadEl = document.getElementById('status-upload');
        const statusCriarEl = document.getElementById('status-criar');
        const statusArquivoEl = document.getElementById('status-arquivo'); // ✅ Nova referência ao status

        // Lógica para o formulário de upload de diretório
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = document.getElementById('token-upload').value;
            const pastaId = document.getElementById('pastaId-upload').value;
            const files = document.getElementById('filePicker').files;

            if (!token || !pastaId || files.length === 0) {
                statusUploadEl.textContent = 'Por favor, preencha todos os campos e selecione uma pasta.';
                return;
            }

            const formData = new FormData();
            formData.append('pastaId', pastaId);
            for (const file of files) {
                formData.append('files', file);
            }

            try {
                statusUploadEl.textContent = 'Enviando...';
                const response = await fetch(`http://localhost:8082/api/pasta/upload-diretorio`, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const result = await response.text();
                    statusUploadEl.textContent = `Sucesso: ${result}`;
                } else {
                    const errorText = await response.text();
                    statusUploadEl.textContent = `Erro: ${response.status} - ${errorText}`;
                }
            } catch (error) {
                statusUploadEl.textContent = `Erro de rede: ${error.message}`;
            }
        });

        // Lógica para o formulário de criação de pasta vazia
        criarPastaForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = document.getElementById('token-criar').value;
            const nomePasta = document.getElementById('nomePasta').value;
            const pastaPaiId = document.getElementById('pastaPaiId-criar').value;

            if (!token || !nomePasta || !pastaPaiId) {
                statusCriarEl.textContent = 'Por favor, preencha todos os campos.';
                return;
            }
            
            // Cria o corpo da requisição no formato JSON
            const data = {
                nomePasta: nomePasta,
                pastaPaiId: pastaPaiId
            };

            try {
                statusCriarEl.textContent = 'Criando pasta...';
                const response = await fetch(`http://localhost:8082/api/pasta`, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    statusCriarEl.textContent = `Sucesso! Pasta criada com ID: ${result.id}`;
                } else {
                    const errorText = await response.text();
                    statusCriarEl.textContent = `Erro: ${response.status} - ${errorText}`;
                }
            } catch (error) {
                statusCriarEl.textContent = `Erro de rede: ${error.message}`;
            }
        });
        
        // ✅ Lógica para o formulário de upload de arquivo individual
        uploadArquivoForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = document.getElementById('token-arquivo').value;
            const pastaId = document.getElementById('pastaId-arquivo').value;
            const files = document.getElementById('file-arquivo').files;

            if (!token || !pastaId || files.length === 0) {
                statusArquivoEl.textContent = 'Por favor, preencha todos os campos e selecione pelo menos um arquivo.';
                return;
            }

            const formData = new FormData();
            formData.append('pastaId', pastaId);
            for (const file of files) {
                formData.append('files', file);
            }

            try {
                statusArquivoEl.textContent = 'Enviando arquivo(s)...';
                const response = await fetch(`http://localhost:8082/api/arquivo/upload`, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const result = await response.text();
                    statusArquivoEl.textContent = `Sucesso: ${result}`;
                } else {
                    const errorText = await response.text();
                    statusArquivoEl.textContent = `Erro: ${response.status} - ${errorText}`;
                }
            } catch (error) {
                statusArquivoEl.textContent = `Erro de rede: ${error.message}`;
            }
        });
    </script>
</body>
</html>